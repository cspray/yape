#!/usr/bin/env php
<?php

$cwd = getcwd();
if (!file_exists($cwd . '/vendor/autoload.php')) {
    include dirname(__DIR__) . '/src/Enum.php';
    include dirname(__DIR__) . '/src/EnumTrait.php';
    include dirname(__DIR__) . '/src/Console/StatusCode.php';
    echo 'Expected to find a Composer autoload.php file in the ./vendor directory but nothing was found.', PHP_EOL;
    exit(\Cspray\Yape\Console\StatusCode::SystemAutoloadInvalid()->getStatusCode());
}

require_once $cwd . '/vendor/autoload.php';

use Cspray\Yape\Console\CreateEnumCommand;
use Cspray\Yape\Console\CreateDbalTypeCommand;
use Cspray\Yape\Internal\ApplicationConfiguration;
use Cspray\Yape\Internal\EnumDefinitionFactory;
use Cspray\Yape\Internal\DbalTypeDefinitionFactory;
use Cspray\Yape\Internal\TemplateEnumCodeGenerator;
use Cspray\Yape\Internal\TemplateDbalTypeCodeGenerator;
use Symfony\Component\Console\Application;

$app = new Application();

$app->setName('yape Enum Generator');
$app->setVersion('2.0.0-rc2');

$templateEnumCodeGenerator = new TemplateEnumCodeGenerator();
$templateDbalTypeCodeGenerator = new TemplateDbalTypeCodeGenerator();
$config = new ApplicationConfiguration(getcwd(), 'src/Enums', 'src/Doctrine');

$createEnumCommand = new CreateEnumCommand($templateEnumCodeGenerator, new EnumDefinitionFactory(), $config);
$createDbalTypeCommand = new CreateDbalTypeCommand($templateDbalTypeCodeGenerator, new DbalTypeDefinitionFactory(), $config);
$app->add($createEnumCommand);
$app->add($createDbalTypeCommand);

$app->run();
